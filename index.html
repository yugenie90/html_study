<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>탐구반 자동 배정</title>
  <link rel="stylesheet" href="./styles.css" />

  <!-- ExcelJS: 엑셀 읽기/쓰기 + 스타일(경고 색상) -->
  <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
</head>

<body>
  <div class="wrap">
    <header class="header">
      <div>
        <h1>탐구반 자동 배정</h1>
        <p class="desc">
          엑셀 1개 업로드(시트: <b>강의정보</b>, <b>학생정보</b>) → 자동 배정 → 결과 엑셀 다운로드
        </p>
      </div>
    </header>

    <section class="card">
      <div class="controls">
        <label class="file">
          <input id="file" type="file" accept=".xlsx" />
          <span>엑셀 업로드</span>
        </label>

        <button id="run" disabled>배정 실행</button>
        <button id="download" disabled>결과 다운로드</button>
      </div>

      <div class="status">
        <div class="badge">조합(탐구1+탐구2) 그룹 우선</div>
        <div class="badge">정원 초과 시 분할 배정</div>
        <div class="badge warn">경고(⚠️) 행은 빨간색</div>
      </div>

      <pre id="log" class="log" aria-live="polite"></pre>
    </section>

    <section class="help">
      <h2>업로드 주의사항</h2>

      <div class="notice">
        <h3>✅ 시트 이름(필수)</h3>
        <ul>
          <li><b>강의정보</b></li>
          <li><b>학생정보</b></li>
        </ul>
        <p class="small">
          * 시트명 오타/공백이 있으면 실행이 실패합니다. (예: “강의 정보”, “학생 정보” ❌)
        </p>

        <h3>✅ 강의정보 컬럼(필수)</h3>
        <p class="small">컬럼명이 정확히 일치해야 합니다(띄어쓰기 포함).</p>
        <ul>
          <li>
            <b>과목</b>, <b>유형</b>, <b>반</b>, <b>강의실</b>, <b>요일</b>, <b>교시</b>, <b>최대인원</b>, <b>소속관</b>, <b>지역</b>
          </li>
          <li class="small">※ <b>유형=선택</b>은 자동 제외됩니다.</li>
          <li class="small">※ <b>지역/소속관</b>은 배정 제약에 사용됩니다. (강의실 텍스트와 달라도 됨)</li>
          <li class="small">※ 요일+교시가 같으면 <b>무조건 충돌</b>로 처리합니다.</li>
        </ul>

        <h3>✅ 학생정보 컬럼(필수)</h3>
        <ul>
          <li><b>일련번호</b>, <b>관</b>, <b>반</b>, <b>탐구1</b>, <b>탐구2</b></li>
          <li class="small">※ 학생의 <b>관</b>은 강의정보의 <b>소속관</b>과 매칭됩니다.</li>
        </ul>

        <h3>✅ 자동 처리 규칙</h3>
        <ul>
          <li><b>필수 수업은 반 기준 고정</b>: 같은 반(D(1) 등) 학생은 동일한 필수시간표로 블로킹</li>
          <li><b>탐구는 조합 우선</b>: 같은 (반+관+탐구1+탐구2) 그룹은 가능한 한 동일한 (탐구1반, 탐구2반) 쌍으로 배정</li>
          <li><b>정원 초과 시 분할 배정</b>: 일부는 같은 조합 유지, 남는 인원은 다른 조합으로 분할 + 경고</li>
          <li><b>충돌은 금지</b>: (필수 포함) 요일+교시 겹치면 배정 불가/경고</li>
        </ul>

        <h3>⚠️ 자주 발생하는 오류</h3>
        <ul>
          <li>시트명/컬럼명이 다름: “최대 인원” vs “최대인원”, “소속 관” vs “소속관”</li>
          <li>관 표기 불일치: “W” vs “W관”</li>
          <li>강의정보에 필수 시간이 누락되어 반 시간표가 비어 있음(해당 반은 경고 처리)</li>
          <li>학생의 관이 지역 매핑 목록에 없어서 “관→지역 매핑 실패” 경고가 발생</li>
        </ul>

        <h3>📌 지역/관 매핑(참고)</h3>
        <p class="small">
          대치: W관, N관, S관, 브릿지관, M3관, 3H관, 신관<br/>
          목동: 목동관, 목동W관<br/>
          기숙: 기숙관
        </p>
      </div>
    </section>

    <footer class="footer">
      <p class="small">
        결과 파일에는 <b>학생별배정</b>, <b>반별명단</b>, <b>요약</b> 시트가 생성됩니다.
      </p>
    </footer>
  </div>

  <script src="./app.js"></script>
</body>
</html>
