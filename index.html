<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>탐구반 자동 배정 (대치 전용)</title>

  <link rel="stylesheet" href="./styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
</head>

<body>
  <div class="app">
    <!-- Top Header -->
    <header class="topbar">
      <div class="topbar-left">
        <div class="mark">A</div>
        <div>
          <h1 class="title">탐구반 자동 배정</h1>
          <p class="subtitle">엑셀 1개 업로드로 탐구반 배정을 빠르고 안전하게 (대치 전용)</p>
        </div>
      </div>

      <div class="topbar-right">
        <span class="pill pill-solid">대치 전용</span>
        <span class="pill">필수 충돌 금지</span>
        <span class="pill">같은 반 조합 우선</span>
        <span class="pill pill-warn">정원 90% 우선</span>
      </div>
    </header>

    <!-- Main 2-col layout -->
    <main class="layout">
      <!-- Main area (75%) -->
      <section class="main">
        <div class="main-grid">
          <!-- Upload & Run -->
          <div class="card">
            <div class="card-head">
              <h2 class="h2">업로드 & 실행</h2>
              <p class="muted">
                업로드 전 <b>강의정보</b>에서 <b>목동/기숙 강의실 행은 삭제</b>해주세요.
              </p>
            </div>

            <label class="upload">
              <input id="file" type="file" accept=".xlsx" />
              <div class="upload-inner">
                <div class="upload-icon">⬆️</div>
                <div class="upload-text">
                  <div class="upload-title">엑셀 파일 업로드</div>
                  <div class="upload-sub">클릭해서 선택하거나 드래그&드롭</div>
                </div>
                <div class="upload-ext">.xlsx</div>
              </div>
            </label>

            <div class="btn-row">
              <button id="run" class="btn btn-primary" disabled>배정 실행</button>
              <button id="download" class="btn btn-secondary" disabled>결과 다운로드</button>
            </div>

            <div class="notice">
              <div class="notice-title">⚠️ 결과 확인</div>
              <div class="notice-body">
                결과 파일에서 <b>미배정사유</b> / <b>불가능탐구목록</b>을 확인하세요.
                <span class="sep">·</span>
                경고가 있는 학생은 <b>빨간색 행</b>으로 표시됩니다.
              </div>
            </div>
          </div>

          <!-- Logs -->
          <div class="card">
            <div class="card-head">
              <h2 class="h2">실행 로그</h2>
              <p class="muted">오류가 나면 로그를 복사해서 공유하면 빠르게 해결돼요.</p>
            </div>

            <pre id="log" class="log" aria-live="polite"></pre>

            <div class="legend">
              <span class="dot dot-ok"></span>성공
              <span class="dot dot-warn"></span>경고
              <span class="dot dot-err"></span>오류
            </div>
          </div>
        </div>
      </section>

      <!-- Right guide (25%) -->
      <aside class="side">
        <div class="side-head">
          <h2 class="h2">사용 설명서</h2>
          <p class="muted">업로드 전/후에 꼭 확인하세요.</p>
        </div>

        <div class="side-body">
          <div class="section">
            <div class="section-title">1) 시트 이름</div>
            <div class="chips">
              <span class="chip">강의정보</span>
              <span class="chip">학생정보</span>
            </div>
            <p class="muted small">띄어쓰기/철자 다르면 실패합니다.</p>
          </div>

          <div class="section">
            <div class="section-title">2) 강의정보 필수 컬럼</div>
            <div class="chips">
              <span class="chip">과목</span><span class="chip">유형</span><span class="chip">반</span>
              <span class="chip">강의실</span><span class="chip">요일</span><span class="chip">교시</span><span class="chip">최대인원</span>
            </div>
            <div class="banner">
              <b>목동/기숙 강의실 행 삭제</b>
              <span>강의실명이 목동/기숙으로 시작하는 행 제거</span>
            </div>
            <p class="muted small">※ 유형=선택 수업은 자동 제외</p>
          </div>

          <div class="section">
            <div class="section-title">3) 학생정보 필수 컬럼</div>
            <div class="chips">
              <span class="chip">일련번호</span><span class="chip">반</span><span class="chip">탐구1</span><span class="chip">탐구2</span>
            </div>
          </div>

          <div class="section">
            <div class="section-title">4) 배정 규칙 요약</div>
            <ul class="list">
              <li>필수수업과 <b>요일+교시가 겹치면</b> 해당 탐구는 불가능</li>
              <li><b>정원 90%</b> 우선 → 먼저 <b>분산</b> → 마지막에 <b>100%</b> 허용</li>
              <li>같은 반은 가능하면 같은 탐구(절대값 아님)</li>
              <li>결과에서 <b>미배정사유</b> / <b>불가능탐구목록</b> 확인</li>
            </ul>
          </div>

          <div class="section">
            <div class="section-title">5) 결과 파일 시트</div>
            <ul class="list">
              <li><b>학생별배정</b>: 학생 기준 결과(사유 포함)</li>
              <li><b>불가능탐구_요약</b>: 반 기준 불가능 탐구 목록</li>
            </ul>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <script src="./app.js"></script>
</body>
</html>
